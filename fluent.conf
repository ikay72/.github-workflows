<label @FLUENT_LOG>
  <match **>
    @type stdout
  </match>
</label>

<source>
  @type tail
  path /var/log/containers/*.log
  pos_file /var/log/fluentd-containers.log.pos
  tag kubernetes.*
  <parse>
    @type regexp
    expression /^(?<time>\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d+Z) (?<stream>stdout|stderr) (?<log>.*)$/
    time_format %Y-%m-%dT%H:%M:%S.%L%z
    types time:time,stream:string,log:string
  </parse>
</source>

<filter kubernetes.**>
  @type kubernetes_metadata
</filter>

<match kubernetes.**>
  @type remote_syslog
  host 10.150.96.30
  port 560
  facility local0
  severity info
  program fluentd
  protocol udp

<buffer>
  flush_interval 10s          # Time interval between flushing the buffer
  flush_thread_count 4        # Number of threads to flush the buffer
  retry_forever true          # Keep retrying indefinitely on errors
  retry_max_interval 30s     # Maximum interval between retries
  chunk_limit_size 1MB     # Maximum size of a chunk of data
  queue_limit_length 128       # Maximum number of queued chunks
  overflow_action block  # Corrected action for handling buffer overflow
</buffer>


  <format>
    @type json
  </format>
</match>

<match **>
  @type stdout
</match>
